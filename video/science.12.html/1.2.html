<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Coulomb's Law & Superposition Principle</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<style>
body {
  margin: 0;
  font-family: "Poppins", sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: radial-gradient(circle at center, #0a0a2a, #1a1a4a);
  color: white;
  text-align: center;
  flex-direction: column;
  overflow: hidden;
  padding: 20px;
}

.bg-particles {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
}

.particle {
  position: absolute;
  background: rgba(100, 200, 255, 0.5);
  border-radius: 50%;
  animation: floatUp linear infinite;
}

@keyframes floatUp {
  0% { transform: translateY(100vh) scale(0.5); opacity: 0.3; }
  50% { opacity: 1; }
  100% { transform: translateY(-20vh) scale(1.2); opacity: 0; }
}

.card {
  background: rgba(0,0,0,0.5);
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 0 20px rgba(100, 150, 255, 0.4);
  width: 80vw;
  max-width: 900px;
  min-width: 300px;
}

.animationBox {
  position: relative;
  width: 100%;
  height: 200px;
  margin: 20px auto;
  opacity: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(10, 20, 40, 0.3);
  border-radius: 12px;
  border: 1px solid rgba(100, 150, 255, 0.3);
}

.charge-icon {
  width: 60px;
  height: 60px;
  margin: 10px;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  opacity: 0;
  transform: scale(0.8);
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.1);
  padding: 5px;
  position: relative;
}

.force-arrow {
  position: absolute;
  height: 3px;
  background: linear-gradient(90deg, #ff3333, #ff9933);
  transform-origin: left center;
  z-index: -1;
}

.caption {
  margin-top: 15px;
  font-size: 1.2rem;
  opacity: 0;
  transform: scale(0.8);
  background: rgba(0,0,0,0.3);
  padding: 12px 20px;
  border-radius: 12px;
  min-height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.controls {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
}

button, select {
  margin: 6px;
  padding: 10px 16px;
  border-radius: 8px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
}

button:hover {
  transform: translateY(-2px);
}

#pauseBtn { 
  background: #4CAF50; 
  color: #fff; 
}

#replayBtn { 
  background: #ff5722; 
  color: #fff; 
  display: none; 
}

select { 
  background: rgba(0,0,0,0.4); 
  color: white; 
  border: 1px solid white; 
  padding: 10px 20px;
}

h2 {
  font-size: 2rem;
  margin-bottom: 10px;
  text-shadow: 0 0 10px rgba(100, 150, 255, 0.5);
}

h3 {
  font-size: 1.5rem;
  margin-bottom: 20px;
  color: #6496ff;
}

.formula {
  font-family: 'Times New Roman', serif;
  font-style: italic;
  margin: 15px 0;
  padding: 10px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
}

/* Responsive */
@media (max-width: 768px) {
  .card { 
    width: 90vw; 
    padding: 20px;
  }
  
  .animationBox {
    height: 180px;
  }
  
  .charge-icon {
    width: 50px;
    height: 50px;
  }
  
  h2 {
    font-size: 1.7rem;
  }
  
  h3 {
    font-size: 1.3rem;
  }
}

@media (max-width: 480px) {
  .animationBox {
    height: 150px;
    flex-direction: column;
    padding: 10px;
  }
  
  .charge-icon {
    width: 40px;
    height: 40px;
    margin: 5px;
  }
  
  .caption {
    font-size: 1rem;
    padding: 10px 15px;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  h3 {
    font-size: 1.1rem;
  }
  
  button, select {
    padding: 8px 14px;
    font-size: 0.9rem;
  }
}
</style>
</head>
<body>

<div class="bg-particles"></div>

<h2>Chapter 2: Coulomb's Law & Superposition Principle</h2>
<h3>Vector form of Coulomb's Law and the Superposition Principle</h3>

<label for="langSelect">ЁЯМР Choose Language:</label>
<select id="langSelect">
  <option value="en">English</option>
  <option value="hi">рд╣рд┐рдиреНрджреА</option>
  <option value="ta">родрооро┐ро┤рпН</option>
  <option value="te">р░др▒Жр░▓р▒Бр░Чр▒Б</option>
  <option value="or">рмУрмбрм╝рм┐рмЖ</option>
</select>

<div class="card">
  <div class="animationBox" id="anim">
    <div class="charge-icon" style="background-image:url('https://img.icons8.com/color/96/positive-dynamic.png')" id="charge1"></div>
    <div class="charge-icon" style="background-image:url('https://img.icons8.com/color/96/negative-dynamic.png')" id="charge2"></div>
    <div class="charge-icon" style="background-image:url('https://img.icons8.com/color/96/positive-dynamic.png')" id="charge3"></div>
    <!-- Force arrows will be added dynamically -->
  </div>

  <div class="caption" id="caption">Coulomb's Law describes the electrostatic force between two point charges.</div>
  
  <div class="formula" id="formula">
    F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)
  </div>
  
  <div class="controls">
    <button id="pauseBtn">тП╕ Pause</button>
    <button id="replayBtn">ЁЯФД Replay</button>
  </div>
</div>

<script>
const caption = document.getElementById("caption");
const replayBtn = document.getElementById("replayBtn");
const pauseBtn = document.getElementById("pauseBtn");
const langSelect = document.getElementById("langSelect");
const formula = document.getElementById("formula");
const animBox = document.getElementById("anim");

let paused = false, currentStep = 0, currentLang = "en";

const captions = {
  en: [
    "Coulomb's Law describes the electrostatic force between two point charges.",
    "The force is directly proportional to the product of the charges and inversely proportional to the square of the distance.",
    "The force acts along the line joining the two charges. This is the vector form: F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "For like charges, the force is repulsive. For opposite charges, it's attractive.",
    "The superposition principle: The net force on a charge is the vector sum of forces from all other charges.",
    "Multiple charges create complex force interactions that follow the superposition principle."
  ],
  hi: [
    "рдХреВрд▓рдореНрдм рдХрд╛ рдирд┐рдпрдо рджреЛ рдмрд┐рдВрджреБ рдЖрд╡реЗрд╢реЛрдВ рдХреЗ рдмреАрдЪ рд╕реНрдерд┐рд░рд╡реИрджреНрдпреБрдд рдмрд▓ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИред",
    "рдмрд▓ рдЖрд╡реЗрд╢реЛрдВ рдХреЗ рдЧреБрдгрдирдлрд▓ рдХреЗ рдЕрдиреБрдХреНрд░рдорд╛рдиреБрдкрд╛рддреА рдФрд░ рджреВрд░реА рдХреЗ рд╡рд░реНрдЧ рдХреЗ рд╡реНрдпреБрддреНрдХреНрд░рдорд╛рдиреБрдкрд╛рддреА рд╣реЛрддрд╛ рд╣реИред",
    "рдмрд▓ рджреЛрдиреЛрдВ рдЖрд╡реЗрд╢реЛрдВ рдХреЛ рдорд┐рд▓рд╛рдиреЗ рд╡рд╛рд▓реА рд░реЗрдЦрд╛ рдХреЗ рдЕрдиреБрджрд┐рд╢ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕рджрд┐рд╢ рд░реВрдк рд╣реИ: F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "рд╕рдорд╛рди рдЖрд╡реЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП, рдмрд▓ рдкреНрд░рддрд┐рдХрд░реНрд╖рдгрд╛рддреНрдордХ рд╣реЛрддрд╛ рд╣реИред рд╡рд┐рдкрд░реАрдд рдЖрд╡реЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЖрдХрд░реНрд╖рдгрд╛рддреНрдордХ рд╣реЛрддрд╛ рд╣реИред",
    "рдЕрдзреНрдпрд╛рд░реЛрдкрдг рд╕рд┐рджреНрдзрд╛рдВрдд: рдПрдХ рдЖрд╡реЗрд╢ рдкрд░ рдХреБрд▓ рдмрд▓ рдЕрдиреНрдп рд╕рднреА рдЖрд╡реЗрд╢реЛрдВ рд╕реЗ рдмрд▓реЛрдВ рдХрд╛ рд╕рджрд┐рд╢ рдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред",
    "рдПрдХрд╛рдзрд┐рдХ рдЖрд╡реЗрд╢ рдЬрдЯрд┐рд▓ рдмрд▓ рдЕрдВрддрдГрдХреНрд░рд┐рдпрд╛рдПрдБ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдЕрдзреНрдпрд╛рд░реЛрдкрдг рд╕рд┐рджреНрдзрд╛рдВрдд рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреА рд╣реИрдВред"
  ],
  ta: [
    "роХрпВро▓рпВроорпНрокро┐ройрпН ро╡ро┐родро┐ роЗро░рогрпНроЯрпБ рокрпБро│рпНро│ро┐ рооро┐ройрпНройрпВроЯрпНроЯроЩрпНроХро│рпБроХрпНроХрпБ роЗроЯрпИропрпЗропро╛рой роиро┐ро▓рпИрооро┐ройрпНройро┐ропро▓рпН ро╡ро┐роЪрпИропрпИ ро╡ро┐ро╡ро░ро┐роХрпНроХро┐ро▒родрпБ.",
    "ро╡ро┐роЪрпИ рооро┐ройрпНройрпВроЯрпНроЯроЩрпНроХро│ро┐ройрпН рокрпЖро░рпБроХрпНроХро▒рпНрокро▓ройрпБроХрпНроХрпБ роирпЗро░рпНро╡ро┐роХро┐родродрпНродро┐ро▓рпБроорпН, родрпВро░родрпНродро┐ройрпН ро╡ро░рпНроХрпНроХродрпНродро┐ро▒рпНроХрпБ роОродро┐ро░рпНро╡ро┐роХро┐родродрпНродро┐ро▓рпБроорпН роЗро░рпБроХрпНроХрпБроорпН.",
    "ро╡ро┐роЪрпИ роЗро░рогрпНроЯрпБ рооро┐ройрпНройрпВроЯрпНроЯроЩрпНроХро│рпИ роЗрогрпИроХрпНроХрпБроорпН роХрпЛроЯрпНроЯро┐ро▓рпН роЪрпЖропро▓рпНрокроЯрпБроорпН. роЗродрпБро╡рпЗ родро┐роЪрпИропройрпН ро╡роЯро┐ро╡роорпН: F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "роТродрпНрод рооро┐ройрпНройрпВроЯрпНроЯроЩрпНроХро│рпБроХрпНроХрпБ, ро╡ро┐роЪрпИ ро╡ро┐ро▓роХрпНроХрпБроорпН родройрпНроорпИропрпБроЯрпИропродрпБ. роОродро┐ро░рпН рооро┐ройрпНройрпВроЯрпНроЯроЩрпНроХро│рпБроХрпНроХрпБ, роЗродрпБ роХро╡ро░рпБроорпН родройрпНроорпИропрпБроЯрпИропродрпБ.",
    "роорпЗро▒рпНрокрпКро░рпБроирпНродро▓рпН родродрпНродрпБро╡роорпН: роТро░рпБ рооро┐ройрпНройрпВроЯрпНроЯродрпНродро┐ройрпН роорпАродрпБ роЪрпЖропро▓рпНрокроЯрпБроорпН роиро┐роХро░ ро╡ро┐роЪрпИ, рооро▒рпНро▒ роЕройрпИродрпНродрпБ рооро┐ройрпНройрпВроЯрпНроЯроЩрпНроХро│ро┐ро▓ро┐ро░рпБроирпНродрпБроорпН ро╡ро░рпБроорпН ро╡ро┐роЪрпИроХро│ро┐ройрпН родро┐роЪрпИропройрпН родрпКроХрпИропро╛роХрпБроорпН.",
    "рокро▓ рооро┐ройрпНройрпВроЯрпНроЯроЩрпНроХро│рпН роорпЗро▒рпНрокрпКро░рпБроирпНродро▓рпН родродрпНродрпБро╡родрпНродрпИрокрпН рокро┐ройрпНрокро▒рпНро▒рпБроорпН роЪро┐роХрпНроХро▓ро╛рой ро╡ро┐роЪрпИ роЗроЯрпИро╡ро┐ройрпИроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ройрпНро▒рой."
  ],
  te: [
    "р░Хр▒Вр░▓р▒Бр░Вр░мр▒Н р░ир░┐р░пр░ор░В р░░р▒Жр░Вр░бр▒Б р░мр░┐р░Вр░жр▒Б р░Жр░╡р▒Зр░╢р░╛р░▓ р░ор░зр▒Нр░п р░Ор░▓р▒Жр░Хр▒Нр░Яр▒Нр░░р▒Лр░╕р▒Нр░Яр░╛р░Яр░┐р░Хр▒Н р░╢р░Хр▒Нр░др░┐р░ир░┐ р░╡р░┐р░╡р░░р░┐р░╕р▒Нр░др▒Бр░Вр░жр░┐.",
    "р░Жр░╡р▒Зр░╢р░╛р░▓ р░▓р░мр▒Нр░зр░╛р░ир░┐р░Хр░┐ р░╢р░Хр▒Нр░др░┐ р░ир▒Зр░░р▒Бр░Чр░╛ р░Ер░ир▒Бр░▓р▒Лр░ор░╛р░ир▒Бр░кр░╛р░др░Вр░▓р▒Л р░Йр░Вр░Яр▒Бр░Вр░жр░┐ р░ор░░р░┐р░пр▒Б р░жр▒Вр░░р░В р░╡р░░р▒Нр░Чр░╛р░ир░┐р░Хр░┐ р░╡р░┐р░▓р▒Лр░ор░╛р░ир▒Бр░кр░╛р░др░Вр░▓р▒Л р░Йр░Вр░Яр▒Бр░Вр░жр░┐.",
    "р░╢р░Хр▒Нр░др░┐ р░░р▒Жр░Вр░бр▒Б р░Жр░╡р▒Зр░╢р░╛р░▓р░ир▒Б р░Хр░▓р░┐р░кр▒З р░░р▒Зр░Ц р░╡р▒Жр░Вр░мр░бр░┐ р░кр░ир░┐р░Ър▒Зр░╕р▒Нр░др▒Бр░Вр░жр░┐. р░Зр░жр░┐ р░╡р▒Жр░Хр▒Нр░Яр░░р▒Н р░░р▒Вр░кр░В: F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "р░Зр░▓р░╛р░Вр░Яр░┐ р░Жр░╡р▒Зр░╢р░╛р░▓р░Хр▒Б, р░╢р░Хр▒Нр░др░┐ р░╡р░┐р░Хр░░р▒Нр░╖р░Хр░Вр░Чр░╛ р░Йр░Вр░Яр▒Бр░Вр░жр░┐. р░╡р▒Нр░пр░др░┐р░░р▒Зр░Х р░Жр░╡р▒Зр░╢р░╛р░▓р░Хр▒Б, р░Зр░жр░┐ р░Жр░Хр░░р▒Нр░╖р░гр▒Ар░пр░Вр░Чр░╛ р░Йр░Вр░Яр▒Бр░Вр░жр░┐.",
    "р░╕р▒Вр░кр░░р▒Нр░кр▒Кр░Ьр░┐р░╖р░ир▒Н р░╕р▒Вр░др▒Нр░░р░В: р░Тр░Х р░Жр░╡р▒Зр░╢р░Вр░кр▒И р░ир░┐р░Хр░░ р░╢р░Хр▒Нр░др░┐ р░Ер░ир▒Нр░ир░┐ р░Зр░др░░ р░Жр░╡р▒Зр░╢р░╛р░▓ р░ир▒Бр░Вр░бр░┐ р░╡р░Ър▒Нр░Ър▒З р░╢р░Хр▒Нр░др▒Бр░▓ р░╡р▒Жр░Хр▒Нр░Яр░░р▒Н р░ор▒Кр░др▒Нр░др░В.",
    "р░мр░╣р▒Бр░│ р░Жр░╡р▒Зр░╢р░╛р░▓р▒Б р░╕р▒Вр░кр░░р▒Нр░кр▒Кр░Ьр░┐р░╖р░ир▒Н р░╕р▒Вр░др▒Нр░░р░╛р░ир▒Нр░ир░┐ р░Ер░ир▒Бр░╕р░░р░┐р░Вр░Ър▒З р░╕р░Вр░Хр▒Нр░▓р░┐р░╖р▒Нр░Я р░╢р░Хр▒Нр░др░┐ р░кр░░р░╕р▒Нр░кр░░ р░Ър░░р▒Нр░пр░▓р░ир▒Б р░╕р▒Гр░╖р▒Нр░Яр░┐р░╕р▒Нр░др░╛р░пр░┐."
  ],
  or: [
    "рмХрнБрм▓рморнНрммрм░ рмирм┐рнЯрмо рмжрнБрмЗрмЯрм┐ рммрм┐рмирнНрмжрнБ рмЪрм╛рм░рнНрмЬ рмормзрнНрнЯрм░рнЗ рмЗрм▓рнЗрмХрнНрмЯрнНрм░рнЛрм╖рнНрмЯрм╛рмЯрм┐рмХрнН рммрм│ рммрм░рнНрмгрнНрмгрмирм╛ рмХрм░рнЗ |",
    "рмЪрм╛рм░рнНрмЬрмЧрнБрмбрм┐рмХрм░ рмЧрнБрмгрмирмлрм│рм░рнЗ рммрм│ рм╕рм┐рмзрм╛рм╕рм│рмЦ рмнрм╛рммрм░рнЗ рмЕрмирнБрмкрм╛рмдрм┐рмХ рмПрммрмВ рмжрнВрм░рмдрм╛рм░ рммрм░рнНрмЧ рм╕рм╣рм┐рмд рммрм┐рмкрм░рнАрмд рмнрм╛рммрм░рнЗ рмЕрмирнБрмкрм╛рмдрм┐рмХ |",
    "рммрм│ рмжрнБрмЗрмЯрм┐ рмЪрм╛рм░рнНрмЬрмХрнБ рмпрнЛрмЧрмХрм░рнБрмерм┐рммрм╛ рм░рнЗрмЦрм╛ рммц▓┐чЭА рмХрм╛рм░рнНрмпрнНрнЯрмХрм░рнЗ | рмПрм╣рм╛ рмнрнЗрмХрнНрмЯрм░ рмлрм░рнНрмо: F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "рм╕рморм╛рми рмЪрм╛рм░рнНрмЬрмЧрнБрмбрм┐рмХ рмкрм╛рмЗрмБ, рммрм│ рммрм┐рмХрм░рнНрм╖рмХ | рммрм┐рмкрм░рнАрмд рмЪрм╛рм░рнНрмЬрмЧрнБрмбрм┐рмХ рмкрм╛рмЗрмБ, рмПрм╣рм╛ рмЖрмХрм░рнНрм╖рмгрнАрнЯ |",
    "рм╕рнБрмкрм░рмкрнЛрмЬрм┐рм╕рмирнН рм╕рм┐рмжрнНрмзрм╛рмирнНрмд: рмПрмХ рмЪрм╛рм░рнНрмЬ рмЙрмкрм░рнЗ рмирм┐рмЯрнН рммрм│ рмЕрмирнНрнЯ рм╕рморм╕рнНрмд рмЪрм╛рм░рнНрмЬрм░рнБ рммрм│рм░ рмнрнЗрмХрнНрмЯрм░ рм╕рморм╖рнНрмЯрм┐ |",
    "рмПрмХрм╛рмзрм┐рмХ рмЪрм╛рм░рнНрмЬрмЧрнБрмбрм┐рмХ рмЬрмЯрм┐рм│ рммрм│ рмкрм╛рм░рм╕рнНрмкрм░рм┐рмХ рмХрнНрм░рм┐рнЯрм╛ рм╕рнГрм╖рнНрмЯрм┐ рмХрм░рнЗ рмпрм╛рм╣рм╛ рм╕рнБрмкрм░рмкрнЛрмЬрм┐рм╕рмирнН рм╕рм┐рмжрнНрмзрм╛рмирнНрмдрмХрнБ рмЕрмирнБрм╕рм░рмг рмХрм░рнЗ |"
  ]
};

const formulas = {
  en: [
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F тИЭ qтВБqтВВ",
    "F тИЭ 1/r┬▓",
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F_net = ╬г F_i",
    "F_net = FтВБ + FтВВ + FтВГ + ..."
  ],
  hi: [
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F тИЭ qтВБqтВВ",
    "F тИЭ 1/r┬▓",
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F_net = ╬г F_i",
    "F_net = FтВБ + FтВВ + FтВГ + ..."
  ],
  ta: [
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F тИЭ qтВБqтВВ",
    "F тИЭ 1/r┬▓",
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F_net = ╬г F_i",
    "F_net = FтВБ + FтВВ + FтВГ + ..."
  ],
  te: [
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F тИЭ qтВБqтВВ",
    "F тИЭ 1/r┬▓",
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F_net = ╬г F_i",
    "F_net = FтВБ + FтВВ + FтВГ + ..."
  ],
  or: [
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F тИЭ qтВБqтВВ",
    "F тИЭ 1/r┬▓",
    "F = k┬╖qтВБqтВВ/r┬▓ ┬╖ (r╠В)",
    "F_net = ╬г F_i",
    "F_net = FтВБ + FтВВ + FтВГ + ..."
  ]
};

function speak(text, lang, callback){
  if(paused) return;
  const utter = new SpeechSynthesisUtterance(text);
  const voiceLang = { en: "en-IN", hi: "hi-IN", ta: "ta-IN", te: "te-IN", or: "en-IN" };
  utter.lang = voiceLang[lang] || "en-IN";
  utter.rate = 0.9;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utter);
  utter.onend = () => { if(!paused) callback(); };
}

function createForceArrow(fromId, toId, color) {
  const fromEl = document.getElementById(fromId);
  const toEl = document.getElementById(toId);
  
  if (!fromEl || !toEl) return null;
  
  const fromRect = fromEl.getBoundingClientRect();
  const toRect = toEl.getBoundingClientRect();
  const animRect = animBox.getBoundingClientRect();
  
  const fromX = fromRect.left + fromRect.width/2 - animRect.left;
  const fromY = fromRect.top + fromRect.height/2 - animRect.top;
  const toX = toRect.left + toRect.width/2 - animRect.left;
  const toY = toRect.top + toRect.height/2 - animRect.top;
  
  const dx = toX - fromX;
  const dy = toY - fromY;
  const distance = Math.sqrt(dx*dx + dy*dy);
  const angle = Math.atan2(dy, dx) * 180 / Math.PI;
  
  const arrow = document.createElement('div');
  arrow.className = 'force-arrow';
  arrow.style.width = `${distance}px`;
  arrow.style.left = `${fromX}px`;
  arrow.style.top = `${fromY}px`;
  arrow.style.transform = `rotate(${angle}deg)`;
  arrow.style.background = color;
  
  animBox.appendChild(arrow);
  return arrow;
}

function runStep(){
  if(currentStep >= captions[currentLang].length){
    replayBtn.style.display = "inline-block";
    return;
  }
  
  // Clear previous arrows
  document.querySelectorAll('.force-arrow').forEach(el => el.remove());
  
  caption.textContent = captions[currentLang][currentStep];
  formula.textContent = formulas[currentLang][currentStep];
  
  gsap.fromTo(caption, {opacity:0, scale:0.8}, {opacity:1, scale:1, duration:0.7, ease:"back.out(1.7)"});
  gsap.fromTo(formula, {opacity:0, scale:0.8}, {opacity:1, scale:1, duration:0.7, ease:"back.out(1.7)"});
  gsap.to("#anim", {opacity:1, duration:1});

  // Create different animations based on the current step
  if (currentStep === 0) {
    gsap.to("#charge1, #charge2", {opacity:1, scale:1, duration:1});
    gsap.to("#charge3", {opacity:0, duration:0.5});
  } 
  else if (currentStep === 1 || currentStep === 2) {
    gsap.to("#charge1, #charge2", {opacity:1, scale:1, duration:1});
    gsap.to("#charge3", {opacity:0, duration:0.5});
    
    // Show force arrows between charge1 and charge2
    createForceArrow("charge1", "charge2", "linear-gradient(90deg, #ff3333, #ff9933)");
    createForceArrow("charge2", "charge1", "linear-gradient(90deg, #3399ff, #33ccff)");
  }
  else if (currentStep === 3) {
    // Show attraction/repulsion
    gsap.to("#charge1", {opacity:1, x: -30, duration:1});
    gsap.to("#charge2", {opacity:1, x: 30, duration:1});
    gsap.to("#charge3", {opacity:0, duration:0.5});
    
    createForceArrow("charge1", "charge2", "linear-gradient(90deg, #ff3333, #ff9933)");
    createForceArrow("charge2", "charge1", "linear-gradient(90deg, #3399ff, #33ccff)");
  }
  else if (currentStep === 4 || currentStep === 5) {
    // Show superposition with three charges
    gsap.to("#charge1, #charge2, #charge3", {opacity:1, scale:1, duration:1});
    
    // Create force arrows for superposition
    createForceArrow("charge1", "charge2", "linear-gradient(90deg, #ff3333, #ff9933)");
    createForceArrow("charge1", "charge3", "linear-gradient(90deg, #ff3333, #ff9933)");
    
    createForceArrow("charge2", "charge1", "linear-gradient(90deg, #3399ff, #33ccff)");
    createForceArrow("charge2", "charge3", "linear-gradient(90deg, #3399ff, #33ccff)");
    
    createForceArrow("charge3", "charge1", "linear-gradient(90deg, #33ff99, #99ff33)");
    createForceArrow("charge3", "charge2", "linear-gradient(90deg, #33ff99, #99ff33)");
  }

  speak(captions[currentLang][currentStep], currentLang, () => {
    currentStep++;
    if(!paused) runStep();
  });
}

pauseBtn.addEventListener("click", () => {
  paused = !paused;
  if(paused) {
    window.speechSynthesis.cancel();
    pauseBtn.textContent = "тЦ╢ Resume";
  } else {
    pauseBtn.textContent = "тП╕ Pause";
    runStep();
  }
});

replayBtn.addEventListener("click", () => {
  currentStep = 0;
  replayBtn.style.display = "none";
  paused = false;
  pauseBtn.textContent = "тП╕ Pause";
  document.querySelectorAll('.force-arrow').forEach(el => el.remove());
  gsap.set(["#charge1", "#charge2", "#charge3"], {opacity:0, x:0, y:0, scale:0.8});
  runStep();
});

// Floating particles
for(let i = 0; i < 30; i++){
  let p = document.createElement("div");
  p.classList.add("particle");
  let size = Math.random() * 6 + 4;
  p.style.width = p.style.height = size + "px";
  p.style.left = Math.random() * 100 + "vw";
  p.style.animationDuration = (Math.random() * 5 + 5) + "s";
  p.style.animationDelay = (Math.random() * 3) + "s";
  document.querySelector(".bg-particles").appendChild(p);
}

langSelect.addEventListener("change", () => {
  currentLang = langSelect.value;
  paused = false;
  currentStep = 0;
  pauseBtn.textContent = "тП╕ Pause";
  replayBtn.style.display = "none";
  window.speechSynthesis.cancel();
  document.querySelectorAll('.force-arrow').forEach(el => el.remove());
  gsap.set(["#charge1", "#charge2", "#charge3"], {opacity:0, x:0, y:0, scale:0.8});
  runStep();
});

// Initialize animation
runStep();
</script>
</body>
</html>